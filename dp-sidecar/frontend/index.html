<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Differential Privacy Voting Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <h1>üîí Differential Privacy Dashboard</h1>
                    <p class="subtitle">Privacy-Protected Voting Results</p>
                </div>
                <div class="header-right">
                    <button id="refreshBtn" class="btn-refresh" title="Refresh data">
                        <span class="refresh-icon">üîÑ</span> Refresh
                    </button>
                    <div class="auto-refresh">
                        <label class="toggle">
                            <input type="checkbox" id="autoRefreshToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label">Auto-refresh (30s)</span>
                    </div>
                </div>
            </div>
            <div class="last-updated">
                <span id="lastUpdated">Last updated: Never</span>
            </div>
        </div>
    </header>

    <!-- Info Banner -->
    <div class="info-banner">
        <div class="container">
            <div class="info-content">
                <div class="info-icon">‚ÑπÔ∏è</div>
                <div class="info-text">
                    <strong>Privacy Protection Active</strong>
                    <p>Vote counts are protected with differential privacy (Œµ=0.5). Individual votes cannot be identified. Counts update every 30 seconds.</p>
                </div>
                <button class="btn-link" id="learnMoreBtn">Learn More</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container">
        <!-- Stats Summary -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-content">
                    <div class="stat-value" id="totalPosts">-</div>
                    <div class="stat-label">Total Posts</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úì</div>
                <div class="stat-content">
                    <div class="stat-value" id="activePosts">-</div>
                    <div class="stat-label">Active</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üîí</div>
                <div class="stat-content">
                    <div class="stat-value" id="lockedPosts">-</div>
                    <div class="stat-label">Locked</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üéØ</div>
                <div class="stat-content">
                    <div class="stat-value">Œµ=0.5</div>
                    <div class="stat-label">Privacy Budget</div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="loading-container">
            <div class="spinner"></div>
            <p>Loading privacy-protected data...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="error-container" style="display: none;">
            <div class="error-icon">‚ö†Ô∏è</div>
            <h3>Unable to Load Data</h3>
            <p id="errorMessage">Could not connect to the API. Make sure the backend is running.</p>
            <button class="btn-primary" onclick="location.reload()">Retry</button>
        </div>

        <!-- Posts Container -->
        <div id="postsContainer" class="posts-container">
            <!-- Posts will be dynamically inserted here -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state" style="display: none;">
            <div class="empty-icon">üì≠</div>
            <h3>No Posts Found</h3>
            <p>No voting posts are currently being tracked. Vote on a post in Fider to get started!</p>
            <a href="http://localhost:3000" target="_blank" class="btn-primary">Go to Fider</a>
        </div>
    </main>

    <!-- Learn More Modal -->
    <div id="learnMoreModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>About Differential Privacy</h2>
                <button class="modal-close" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <h3>üîí How Your Privacy is Protected</h3>
                <p>This dashboard uses <strong>differential privacy</strong> to protect individual votes while still providing useful voting results.</p>
                
                <h4>Key Features:</h4>
                <ul>
                    <li><strong>Noise Addition:</strong> Random noise (Laplace mechanism) is added to each count</li>
                    <li><strong>Fixed-Schedule Releases:</strong> Counts update every 30 seconds, preventing timing attacks</li>
                    <li><strong>Noise Reuse:</strong> Same noise when count unchanged, preventing averaging attacks</li>
                    <li><strong>Budget Tracking:</strong> Each post can change ~40 times before locking permanently</li>
                </ul>

                <h4>Privacy Guarantees:</h4>
                <ul>
                    <li>‚úì Individual votes cannot be identified</li>
                    <li>‚úì Œµ=0.5 differential privacy per release</li>
                    <li>‚úì Timing attacks prevented</li>
                    <li>‚úì Averaging attacks prevented</li>
                </ul>

                <h4>What the Numbers Mean:</h4>
                <ul>
                    <li><strong>~48 votes:</strong> Approximate count (noise added for privacy)</li>
                    <li><strong>(41-55 range):</strong> 95% confidence interval for true count</li>
                    <li><strong>Budget: 80%:</strong> Remaining privacy budget (locks at 0%)</li>
                </ul>

                <div class="modal-footer">
                    <a href="https://en.wikipedia.org/wiki/Differential_privacy" target="_blank" class="btn-link">Learn More About DP</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>Differential Privacy Voting System | Œµ-DP with Laplace Mechanism</p>
            <p class="footer-links">
                <a href="http://localhost:3000" target="_blank">Go to Fider</a>
                <span>‚Ä¢</span>
                <a href="http://localhost:8000/docs" target="_blank">API Docs</a>
                <span>‚Ä¢</span>
                <a href="#" id="aboutLink">About</a>
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
</body>
</html>